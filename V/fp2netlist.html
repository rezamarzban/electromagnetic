<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPICE Netlist Generator</title>
    <style>
        body { font-family: Arial, sans-serif; }
        label { display: block; margin-top: 10px; }
        input { margin-bottom: 10px; }
        pre { background-color: #f4f4f4; padding: 10px; border: 1px solid #ddd; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>SPICE Netlist Generator for Resonant Circuit</h1>
    <p>Enter the oscillation frequency (Hz) and desired RMS current through Rant (A) to generate the SPICE netlist.</p>
    
    <label for="freq">Oscillation Frequency (Hz):</label>
    <input type="text" id="freq" value="503292">
    
    <label for="irms">RMS Current through Rant (A):</label>
    <input type="text" id="irms" value="0.0166">
    
    <button onclick="generateNetlist()">Generate Netlist</button>
    
    <h2>Generated Netlist:</h2>
    <pre id="output"></pre>

    <script>
        function formatValue(val) {
            if (val === 0) return "0";
            let absVal = Math.abs(val);
            let exp = Math.floor(Math.log10(absVal));
            let mantissa;
            let suffix = "";
            if (exp >= 0) {
                return val.toPrecision(6);
            } else if (exp >= -3) {
                mantissa = val * 1e3;
                suffix = "m";
            } else if (exp >= -6) {
                mantissa = val * 1e6;
                suffix = "u";
            } else if (exp >= -9) {
                mantissa = val * 1e9;
                suffix = "n";
            } else if (exp >= -12) {
                mantissa = val * 1e12;
                suffix = "p";
            } else {
                mantissa = val * 1e15;
                suffix = "f";
            }
            return mantissa.toPrecision(6) + suffix;
        }

        function formatFreqOrCurrent(val) {
            if (val < 1e12) {
                return formatValue(val);
            } else {
                return val.toPrecision(6);
            }
        }

        function generateNetlist() {
            let f = parseFloat(document.getElementById('freq').value);
            let I_rms = parseFloat(document.getElementById('irms').value);
            
            if (isNaN(f) || isNaN(I_rms) || f <= 0 || I_rms <= 0) {
                alert("Please enter valid positive numbers for frequency and RMS current.");
                return;
            }
            
            const Z0 = 42.5;
            const pi = Math.PI;
            const sqrt = Math.sqrt;
            
            let C1 = 1 / (2 * pi * f * Z0);
            let L1 = Z0 / (2 * pi * f);
            let Lant = Z0 / (2 * pi * f);
            let V_peak = I_rms * Z0 * sqrt(2);
            
            let f_str = formatFreqOrCurrent(f);
            let I_str = I_rms.toPrecision(6);
            let V_str = V_peak.toPrecision(6);
            let L1_str = formatValue(L1);
            let C1_str = formatValue(C1);
            let Lant_str = formatValue(Lant);
            
            let netlist = `* Resonant Circuit Netlist\n` +
                          `* Oscillation Frequency: ${f_str} Hz\n` +
                          `* Desired RMS Current through Rant: ${I_str} A\n` +
                          `* Characteristic Impedance Z0: ${Z0} Ohm\n\n` +
                          `V1 1 0 AC ${V_str}\n` +
                          `R1 1 2 0.01\n` +
                          `L1 2 3 ${L1_str}\n` +
                          `C1 3 0 ${C1_str}\n` +
                          `Rant 3 4 73\n` +
                          `Lant 4 0 ${Lant_str}\n\n` +
                          `* AC analysis at the oscillation frequency\n` +
                          `.ac list ${f_str}\n\n` +
                          `.end`;
            
            document.getElementById('output').textContent = netlist;
        }
    </script>
</body>
</html>
